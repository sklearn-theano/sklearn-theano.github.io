
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
    <title>Localizing multiple objects in an image &mdash; sklearn-theano 0.0.1 documentation</title>
  <!-- htmltitle is before nature.css - we use this hack to load bootstrap first -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../static/css/bootstrap.min.css" media="screen" />
  <link rel="stylesheet" href="../static/css/bootstrap-responsive.css"/>

    
    <link rel="stylesheet" href="../static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/js/copybutton.js"></script>
    <script type="text/javascript" src="../static/js/examples.js"></script>
    <link rel="shortcut icon" href="../static/mini_sloth_bw.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="sklearn-theano 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Examples" href="index.html" />
    <link rel="next" title="Visualization of first layer filters" href="plot_overfeat_layer1_filters.html" />
    <link rel="prev" title="Asirra dataset classification using transformer" href="plot_asirra_dataset.html" />
  
   
       <script type="text/javascript" src="../static/sidebar.js"></script>
   
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="../static/js/bootstrap.min.js" type="text/javascript"></script>
  <link rel="canonical" href="http://sklearn-theano.github.io/dev/auto_examples/plot_multiple_localization.html" />

  <script type="text/javascript">
    $("div.buttonNext, div.buttonPrevious").hover(
       function () {
           $(this).css('background-color', '#FF9C34');
       },
       function () {
           $(this).css('background-color', '#A7D6E2');
       }
    );
    var bodywrapper = $('.bodywrapper');
    var sidebarbutton = $('#sidebarbutton');
    sidebarbutton.css({'height': '900px'});
  </script>

  </head>
  <body>

<div class="header-wrapper">
    <div class="header">
        <p class="logo"><a href="../index.html">
            <img src="../static/mini_sloth_bw.png" alt="Logo"/>
        </a>
        </p><div class="navbar">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../install.html">Installation</a></li>
                <li class="btn-li"><div class="btn-group">
		      <a href="../documentation.html">Documentation</a>
		      <a class="btn dropdown-toggle" data-toggle="dropdown">
			     <span class="caret"></span>
		      </a>
		      <ul class="dropdown-menu">
			<li class="link-title">sklearn-theano 0.1 (development)</li>
			<li><a href="../user_guide.html">User guide</a></li>
			<li><a href="../modules/classes.html">API</a></li>
			<li class="divider"></li>
		        <li><a href="http://sklearn-theano.github.io/dev/documentation.html">Development</a></li>
		        <li><a href="../documentation.html">More versions...</a></li>
		      </ul>
		    </div>
		</li>
            <li><a href="index.html">Examples</a></li>
            </ul>

            <div class="search_form">
                <div id="cse" style="width: 100%;"></div>
            </div>
        </div> <!-- end navbar --></div>
</div>


<!-- Github "fork me" ribbon -->
<a href="https://github.com/sklearn-theano/sklearn-theano">
  <img class="fork-me"
       style="position: absolute; top: 0; right: 0; border: 0;"
       src="../static/img/forkme.png"
       alt="Fork me on GitHub" />
</a>

<div class="content-wrapper">
    <div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
        <div class="rel">
    

  <!-- rellinks[1:] is an ugly hack to avoid link to module
  index -->
        <div class="rellink">
        <a href="plot_asirra_dataset.html"
        accesskey="P">Previous
        <br/>
        <span class="smallrellink">
        Asirra dataset c...
        </span>
            <span class="hiddenrellink">
            Asirra dataset classification using transformer
            </span>
        </a>
        </div>
            <div class="spacer">
            &nbsp;
            </div>
        <div class="rellink">
        <a href="plot_overfeat_layer1_filters.html"
        accesskey="N">Next
        <br/>
        <span class="smallrellink">
        Visualization of...
        </span>
            <span class="hiddenrellink">
            Visualization of first layer filters
            </span>
        </a>
        </div>

    <!-- Ad a link to the 'up' page -->
        <div class="spacer">
        &nbsp;
        </div>
        <div class="rellink">
        <a href="index.html">
        Up
        <br/>
        <span class="smallrellink">
        Examples
        </span>
            <span class="hiddenrellink">
            Examples
            </span>
            
        </a>
        </div>
    </div>
    
      <p class="doc-version">This documentation is for sklearn-theano <strong>version 0.0.1</strong> &mdash; <a href="http://sklearn-theano.github.io/dev/support.html#documentation-resources">Other versions</a></p>
    <p class="citing">If you are reading this, thanks for using <a href="../about.html#sklearn-theano">sklearn-theano</a>.</p>
    <ul>
<li><a class="reference internal" href="#">Localizing multiple objects in an image</a></li>
</ul>

    </div>
</div>



      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="localizing-multiple-objects-in-an-image">
<span id="example-plot-multiple-localization-py"></span><h1>Localizing multiple objects in an image<a class="headerlink" href="#localizing-multiple-objects-in-an-image" title="Permalink to this headline">Â¶</a></h1>
<p>Extending on the <tt class="docutils literal"><span class="pre">plot_localization_tutorial</span></tt> example, there are more advanced
ways to search for objects, and draw bounding boxes.</p>
<p>Rather than using the full class label, we can also use the wordnet hierarchy to
describe groups of labels which apply. In this case the high level labels
&#8216;cat&#8217; and &#8216;dog&#8217; are used to search through the image. By specifying &#8216;cat.n.01&#8217;,
the OverfeatLocalizer will use class tags which fall into the group of
&#8216;cat.n.01&#8217; based on the WordNet hierarchy. Dogs work the same same way, using
&#8216;dog.n.01&#8217;.</p>
<p>By allowing specification of higher level groupings, it is easier
to search for a variety of subjects, but may lead to confusion when drawing
bounding boxes if the subjects both fall under the same WordNet group, but are
not the same class. Imagine an image of two different species cats -
in this case the exact class labels may be better at creating bounding boxes.</p>
<p>It is also beneficial to use the scikit-learn&#8217;s Gaussian Mixture Models to
better estimate bounding boxes without the influence of outliers. In this case,
one Gaussian will be placed to try and describe all of the matched points. Using
a width and height bound of 3 standard deviations, it is possible to draw
bounding boxes which are more robust to spurious points than the simple
method used in <tt class="docutils literal"><span class="pre">plot_single_localization</span></tt>.</p>
<img alt="../images/plot_multiple_localization_001.png" class="align-center" src="../images/plot_multiple_localization_001.png" />
<p><strong>Python source code:</strong> <a class="reference download internal" href="../downloads/plot_multiple_localization.py"><tt class="xref download docutils literal"><span class="pre">plot_multiple_localization.py</span></tt></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>
<span class="kn">from</span> <span class="nn">sklearn_theano.datasets</span> <span class="kn">import</span> <span class="n">load_sample_image</span>
<span class="kn">from</span> <span class="nn">sklearn_theano.feature_extraction</span> <span class="kn">import</span> <span class="n">OverfeatLocalizer</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GMM</span>


<span class="k">def</span> <span class="nf">convert_gmm_to_box</span><span class="p">(</span><span class="n">gmm</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="n">midpoint</span> <span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">means_</span>
    <span class="n">std</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="n">covars_</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">upper_left_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">midpoint</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">midpoint</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">upper_left_point</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                     <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">load_sample_image</span><span class="p">(</span><span class="s">&quot;cat_and_dog.jpg&quot;</span><span class="p">)</span>
<span class="n">dog_label</span> <span class="o">=</span> <span class="s">&#39;dog.n.01&#39;</span>
<span class="n">cat_label</span> <span class="o">=</span> <span class="s">&#39;cat.n.01&#39;</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">OverfeatLocalizer</span><span class="p">(</span><span class="n">top_n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">match_strings</span><span class="o">=</span><span class="p">[</span><span class="n">dog_label</span><span class="p">,</span> <span class="n">cat_label</span><span class="p">])</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float32&#39;</span><span class="p">))</span>
<span class="n">dog_points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cat_points</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">GMM</span><span class="p">()</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dog_points</span><span class="p">)</span>
<span class="n">dog_box</span> <span class="o">=</span> <span class="n">convert_gmm_to_box</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s">&quot;darkred&quot;</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cat_points</span><span class="p">)</span>
<span class="n">cat_box</span> <span class="o">=</span> <span class="n">convert_gmm_to_box</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="s">&quot;steelblue&quot;</span><span class="p">,</span> <span class="o">.</span><span class="mi">6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">dog_box</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">cat_box</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Total running time of the example:</strong>  158.60 seconds
( 2 minutes  38.60 seconds)</p>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer">
        &copy; 2014 - 2016, sklearn-theano developers (BSD License).
      <a href="../sources/auto_examples/plot_multiple_localization.txt" rel="nofollow">Show this page source</a>
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="plot_asirra_dataset.html">Previous
      </a>
    </div>
    <div class="buttonNext">
      <a href="plot_overfeat_layer1_filters.html">Next
      </a>
    </div>
    
     </div>

    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      # Set google analytics
# FIXME
      _gaq.push(['_setAccount', '222']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> google.load('search', '1',
        {language : 'en'}); google.setOnLoadCallback(function() {
            var customSearchControl = new
            #FIXME
            google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.setAutoComplete(true);
            customSearchControl.draw('cse', options); }, true);
    </script>
  </body>
</html>